COPY START 2000
FIRST STL RETADR
CLOOP JSUB RDREC
_ LDA LENGTH
_ COMP ZERO
_ JEQ ENDFIL
_ JSUB WRREC
_ J CLOOP
ENDFIL LDA EOF
_ STA BUFFER
_ LDA THREE
_ STA LENGTH
_ JSUB WRREC
_ LDL RETADR
_ RSUB _
EOF BYTE C'EOF'
THREE WORD 3
ZERO WORD 0
RETADR RESW 1
LENGTH RESW 1
BUFFER RESB 4096
RDREC LDX ZERO
_ LDA ZERO
RLOOP TD INPUT
_ JEQ RLOOP
_ RD INPUT
_ COMP ZERO
_ JEQ EXIT
_ STCH BUFFER,X
_ TIX MAXLEN
_ JLT RLOOP
EXIT STX LENGTH
_ RSUB _
INPUT BYTE X'F1'
MAXLEN WORD 4096
WRREC LDX ZERO
WLOOP TD OUTPUT
_ JEQ WLOOP
_ LDCH BUFFER,X
_ WD OUTPUT
_ TIX LENGTH
_ JLT WLOOP
_ RSUB _
OUTPUT BYTE X'05'
_ END FIRST
